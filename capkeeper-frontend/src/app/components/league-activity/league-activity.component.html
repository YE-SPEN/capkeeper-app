<div class="flex items-center justify-between flex-column md:flex-row py-4 bg-white dark:bg-gray-900">
    <div class="w-full">
        <h1 class="font-bold text-2xl">
            Recent Activity
        </h1>
        <!-- Control Panel -->
        <div class="flex flex-wrap items-start pt-6 space-y-4 md:space-y-0 md:space-x-4">

            <!-- User Multi-Select -->
            <div class="relative flex flex-col w-full md:w-auto">
                <label for="dateFilter" class="text-left block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">&nbsp;</label>
                
                <button id="dropdownBgHoverButton" data-dropdown-toggle="dropdownBgHover" class="text-white bg-green-400 hover:bg-green-500 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-green-400 dark:hover:bg-green-500 dark:focus:ring-green-300" type="button">
                  Select Users
                  <span class="inline-flex items-center justify-center w-5 h-5 ms-2 text-xs font-semibold text-green-800 bg-green-200 rounded-full">
                    {{ selected_users.length }}
                  </span>
                  <svg class="w-2.5 h-2.5 ms-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
                  </svg>
                </button>
              
                <!-- Dropdown menu -->
                <div id="dropdownBgHover" class="absolute z-10 hidden w-64 bg-white rounded-lg shadow dark:bg-gray-700" style="top: 100%; left: 10;">
                  <ul class="p-3 space-y-1 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownBgHoverButton">
                    <li>
                      <a *ngIf="selected_users.length > 0" (click)="deselectAllUsers()" class="cursor-pointer font-medium text-green-500 dark:text-green-500 hover:underline">
                        Deselect All
                      </a>
                      <a *ngIf="selected_users.length === 0" (click)="selectAllUsers()" class="cursor-pointer font-medium text-green-500 dark:text-green-500 hover:underline">
                        Select All
                      </a>
                      <div class="py-1">
                        <hr class="border-0 border-t-2 border-gray-300">   
                      </div>
                    </li>  
                    <li *ngFor="let user of users">
                      <div class="flex items-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <input             
                          id="user-checkbox-{{ user.user_name }}"
                          type="checkbox" 
                          [checked]="isSelected(user)"
                          (change)="toggleUserSelect($event, user)"
                          class="w-4 h-4 text-green-400 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-500 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                        >
                        <label for="user-checkbox-{{ user.user_name }}" class="w-full ms-2 text-sm font-medium text-gray-900 rounded dark:text-gray-300">
                          {{ user.first_name }} {{ user.last_name }}
                        </label>
                      </div>
                    </li>                                                                              
                  </ul>
                </div>
              </div>              
              
            
            <!-- Action Filter with Label -->
            <div class="flex flex-col w-full md:w-auto">
                <label for="actionFilter" class="text-left block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Filter by Action</label>
                <select id="actionFilter" [(ngModel)]="activityFilter" (ngModelChange)="filterActivities()" class="bg-gray-50 border border-green-400 text-gray-900 text-sm rounded-lg focus:ring-green-400 focus:border-green-400 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-green-400 dark:focus:border-green-400 min-w-[160px]">
                    <option value="all">All Types</option>
                    <option value="Add/Drop">Add/Drops</option>
                    <option value="Roster Move">Roster Moves</option>
                    <option value="Trade">Trades</option>
                    <option value="Trade Block">Trade Block</option>
                    <option value="Database Update">Database Updates</option>         
                </select>
            </div>
        
            <!-- Date Filter with Label -->
            <div class="flex flex-col w-full md:w-auto">
                <label for="dateFilter" class="text-left block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Filter by Date</label>
                <select id="dateFilter" (ngModelChange)="setDateRange($event)" class="bg-gray-50 border border-green-400 text-gray-900 text-sm rounded-lg focus:ring-green-400 focus:border-green-400 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-green-400 dark:focus:border-green-400 min-w-[160px]">
                    <option value="7">This Week</option>
                    <option value="30">Last 30 days</option>
                    <option value="90">Last 3 months</option>
                    <option value="365">Last 12 months</option>
                    <option value="0">Custom</option>          
                </select>
            </div>
        
            <!-- Custom Date Range -->
            <div>
                <div class="flex flex-col w-full md:w-auto ml-auto md:ml-0">
                    <label for="date-range-picker" class="text-left block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Custom Date Range</label>
                    
                    <!-- Date Range Picker -->     
                    <div id="date-range-picker" date-rangepicker class="relative flex items-center">
                        <!-- Start Date -->
                        <div class="relative">
                            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                                </svg>
                            </div>
                            <input (change)="setStartDate($event)" id="datepicker-range-start" name="start" type="text" datepicker-format="yyyy-mm-dd" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-400 focus:border-green-400 block w-full ps-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-green-400 dark:focus:border-green-400" placeholder="Select date start">
                        </div>
            
                        <span class="mx-2 text-gray-500">to</span>
            
                        <!-- End Date -->
                        <div class="relative">
                            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                                </svg>
                            </div>
                            <input (change)="setEndDate($event)" id="datepicker-range-end" name="end" type="text" datepicker-format="yyyy-mm-dd" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-400 focus:border-green-400 block w-full ps-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-green-400 dark:focus:border-green-400" placeholder="Select date end">
                        </div>
                    </div>
                </div>
            </div>
        </div>
                 
    </div>
</div>

<div class="overflow-x-auto mb-4 rounded m:rounded-lg shadow-md border-2 max-h-[800px]">
    <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
        <tr class="border-b-2 sticky top-0">
            <th scope="col" class="p-4 bg-gray-50 dark:bg-gray-700">
                
            </th>
            <th scope="col" class="text-left p-4 bg-gray-50 dark:bg-gray-700">
                Description
            </th>
            <th scope="col" class="text-left p-4 bg-gray-50 dark:bg-gray-700">
                Type
            </th>
            <th scope="col" 
                class="p-4 bg-gray-50 dark:bg-gray-700 hover:text-gray-500 hover:cursor-pointer"
                [ngClass]="{'text-green-400 hover:text-green-600': sortingService.sortColumn === 'user_id'}"
                (click)="sortingService.toggleSort(activity_log, 'user_id')"
            >
                <span class="flex items-center">
                    User
                    <svg class="w-4 h-4 ms-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path *ngIf="sortingService.sortColumn !== 'user_id'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m8 15 4 4 4-4m0-6-4-4-4 4"/>
                        <path *ngIf="sortingService.sortColumn === 'user_id' && sortingService.sortDirection === 'desc'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/>
                        <path *ngIf="sortingService.sortColumn === 'user_id' && sortingService.sortDirection === 'asc'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 15 7-7 7 7"/>   
                    </svg>
                </span>
            </th>
            <th scope="col" 
                class="p-4 bg-gray-50 dark:bg-gray-700 hover:text-gray-500 hover:cursor-pointer"
                [ngClass]="{'text-green-400 hover:text-green-600': sortingService.sortColumn === 'date'}"
                (click)="sortingService.toggleSort(activity_log, 'date')"
            >
                <span class="flex items-center">
                    Date
                    <svg class="w-4 h-4 ms-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path *ngIf="sortingService.sortColumn !== 'date'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m8 15 4 4 4-4m0-6-4-4-4 4"/>
                        <path *ngIf="sortingService.sortColumn === 'date' && sortingService.sortDirection === 'desc'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/>
                        <path *ngIf="sortingService.sortColumn === 'date' && sortingService.sortDirection === 'asc'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 15 7-7 7 7"/>   
                    </svg>
                </span>
            </th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let activity of filtered_activity_log" class="border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">

            <td class="py-2 px-4 dark:bg-gray-800">
                <div class="flex items-center">
                    <svg 
                    class="w-7 h-7" 
                    [ngClass]="{
                        'text-green-400': activity.action_type === 'add-player' || activity.action_type === 'create-player',
                        'text-red-400': activity.action_type === 'drop-player' || activity.action_type === 'ir',
                        'text-blue-700': activity.action_type === 'trade' || activity.action_type === 'callup',
                        'text-gray-800': activity.action_type === 'edit-player' || activity.action_type === 'edit-contract',
                        'text-yellow-300': activity.action_type === 'trade-block',
                    }" 
                    aria-hidden="true" 
                    xmlns="http://www.w3.org/2000/svg" 
                    width="24" 
                    height="24" 
                    fill="none" 
                    viewBox="0 0 24 24">
                        <path *ngIf="activity.action_type === 'add-player'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 7.757v8.486M7.757 12h8.486M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                        <path *ngIf="activity.action_type === 'drop-player'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7.757 12h8.486M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                        <path *ngIf="activity.action_type === 'create-player'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12h4m-2 2v-4M4 18v-1a3 3 0 0 1 3-3h4a3 3 0 0 1 3 3v1a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1Zm8-10a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                        <path *ngIf="activity.action_type === 'edit-player'" stroke="currentColor" stroke-linecap="square" stroke-linejoin="round" stroke-width="2" d="M7 19H5a1 1 0 0 1-1-1v-1a3 3 0 0 1 3-3h1m4-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm7.441 1.559a1.907 1.907 0 0 1 0 2.698l-6.069 6.069L10 19l.674-3.372 6.07-6.07a1.907 1.907 0 0 1 2.697 0Z"/>
                        <path *ngIf="activity.action_type === 'trade-block'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.583 8.445h.01M10.86 19.71l-6.573-6.63a.993.993 0 0 1 0-1.4l7.329-7.394A.98.98 0 0 1 12.31 4l5.734.007A1.968 1.968 0 0 1 20 5.983v5.5a.992.992 0 0 1-.316.727l-7.44 7.5a.974.974 0 0 1-1.384.001Z"/>
                        <path *ngIf="activity.action_type === 'trade'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16h13M4 16l4-4m-4 4 4 4M20 8H7m13 0-4 4m4-4-4-4"/>
                        <path *ngIf="activity.action_type === 'ir'" stroke="currentColor" stroke-linecap="round" stroke-width="2" d="m6 6 12 12m3-6a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                        <path *ngIf="activity.action_type === 'callup'" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 20V10m0 10-3-3m3 3 3-3m5-13v10m0-10 3 3m-3-3-3 3"/>
                        <path *ngIf="activity.action_type === 'edit-contract'"stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 3v4a1 1 0 0 1-1 1H5m4 8h6m-6-4h6m4-8v16a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V7.914a1 1 0 0 1 .293-.707l3.914-3.914A1 1 0 0 1 9.914 3H18a1 1 0 0 1 1 1Z"/>
                          
                            
                    </svg>        
                </div>
            </td>            

            <td class="items-left py-2 min-w-52 text-gray-900 whitespace-nowrap dark:text-white dark:bg-gray-800">
                <div class="flex items-center text-md font-semibold text-gray-900 dark:text-white align-middle">
                    {{ activity.message }} 
                    <div *ngIf="isNew(activity)">
                        <span class="bg-green-400 text-white text-xs font-normal ml-2 me-2 px-1.5 py-0.5 rounded dark:bg-gray-700 dark:text-green-400 border border-green-400">
                            New
                        </span>
                    </div>
                </div>
            </td>
            <td class="px-6 py-2">
                {{ formatActionType(activity.action_type) }}
            </td>
            <td class="px-6 py-2">
                {{ getUser(activity.user_id) }}
            </td>
            <td class="px-6 py-2">
                {{ formatDateTime(activity.date, activity.time) }}
            </td>
        </tr>
        </tbody>
    </table>
</div>


